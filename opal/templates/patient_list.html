{% include 'patient_list_navbar.html' %}

<table class="table table-bordered" freeze-panes>
	<thead>
		<tr>
			{% for column in columns %}
			<th>{{ column.title }}</th>
			{% endfor %}
		</tr>
	</thead>
	<tbody>
	<tr ng-repeat="row in rows">
		{% for column in columns %}
		<td ng-mouseenter="mouseEnter($index, {{ forloop.counter0 }})"
			ng-mouseleave="mouseLeave()">
			<ul>
				<li ng-repeat="item in row.{{column.name}}"
				ng-click="selectItem($parent.$index, {{ forloop.counter0 }}, $index)"
				ng-dblclick="editItem($parent.$index, {{ forloop.counter0 }}, $index)"
				ng-class="{selected: rix == $parent.$index && cix == {{ forloop.counter0 }} && iix == $index}">
				{% include column.template_path %}

				{% if not column.single %}
				<li ng-click="selectItem($index, {{ forloop.counter0 }}, row.{{column.name}}.length)"
				ng-dblclick="editItem($index, {{ forloop.counter0 }})"
				ng-class="{selected: rix == $index && cix == {{ forloop.counter0 }} && iix == row.{{column.name}}.length}">
					<span ng-show="(rix == $index && cix == {{ forloop.counter0 }}) ||
						(mouseRix == $index && mouseCix == {{ forloop.counter0 }})">
						Add
					</span>
					&nbsp;
				</li>
				{% endif %}
				</li>
			</ul>
		</td>
		{% endfor %}
	</tr>
	</tbody>
</table>

{% include 'patient_list_navbar.html' %}

<center>
  <a href="#keyboard-shortcuts" role="button" data-toggle="modal" class="screen-only">
    <i class="icon-keyboard"></i> Keyboard shortcuts available
  </a>
</center>

{% for column in columns %}
<div id="{{column.name}}-modal" class="modal hide" tabindex="-1" role="dialog">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" ng-click="cancelEdit()">×</button>
		<h3>{{column.title}} ([[editingName]])</h3>
	</div>
	<div class="modal-body">{% include column.modal_template_path %}</div>
	<div class="modal-footer">
		<button class="btn btn-primary" ng-click="saveEdit()">Save</button>
		{% if not column.single %}
		<button class="btn btn" ng-click="saveEditAndAdd(e)">Save and add another</button>
		{% endif %}
		<button class="btn" ng-click="cancelEdit()">Cancel</button>
	</div>
</div>
{% endfor %}

<div id="add-new-modal" class="modal hide" tabindex="-1" role="dialog">
	<div class="modal-header">
		<button type="button" class="close" ng-click="cancelAdd()">×</button>
		<h3>New record</h3>
	</div>
	<div class="modal-body">
		<form class="form-horizontal">
			<div class="control-group">
				<label class="control-label">Hospital number</label>
				<div class="controls">
					<input type="text" ng-model="editing.demographics.hospital_number">
					<button class="btn" ng-click="findByHospitalNumber()" ng-hide="foundPatient" ng-disabled="findingPatient">Search</button>
				</div>
			</div>
			<div ng-show="foundPatient">
				<div class="control-group">
					<label class="control-label">Name</label>
					<div class="controls">
						<input type="text" ng-model="editing.demographics.name">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">Date of birth</label>
					<div class="controls">
						<input type="text"
							ng-model="editing.demographics.date_of_birth"
							ng-pattern="/^(0?[1-9]|[12][0-9]|3[01])\/(0?[1-9]|1[012])\/(\d{4})$/"
							placeholder="dd/mm/yyyy">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">Category</label>
					<div class="controls">
						<input type="text" ng-model="editing.location.category" bs-typeahead="patient_category_list" data-provide="typeahead" data-min-length=0>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">Hospital</label>
					<div class="controls">
						<input type="text" ng-model="editing.location.hospital" bs-typeahead="hospital_list" data-provide="typeahead">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">Ward</label>
					<div class="controls">
						<input type="text" ng-model="editing.location.ward">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">Bed</label>
					<div class="controls">
						<input type="text" ng-model="editing.location.bed">
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">Date of admission</label>
					<div class="controls">
						<input type="text" ng-model="editing.location.date_of_admission" bs-datepicker>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">Tags</label>
					<div class="controls">
						{% for key, name in tags.items %}
						<label class="checkbox">
							<input type="checkbox" ng-model="editing.tags.{{key}}">
							{{name}}
						</label>
						{% endfor %}
					</div>
				</div>
			</div>
		</form>
	</div>
	<div class="modal-footer">
		<button class="btn btn-primary" ng-show="foundPatient" ng-click="saveAdd()">Save record</button>
		<button class="btn" ng-click="cancelAdd()">Cancel</button>
	</div>
</div>

<div id="delete-confirmation" class="modal hide" tabindex="-1" role="dialog">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" ng-click="cancelDelete()">×</button>
		<h3>Delete item?</h3>
	</div>
	<div class="modal-body"><p>Do you want to delete this item?</p></div>
	<div class="modal-footer">
		<button class="btn btn-primary" data-dismiss="modal" ng-click="doDelete()">Yes</button>
		<button class="btn" data-dismiss="modal" ng-click="cancelDelete()">No</button>
	</div>
</div>

<div id="discharge-confirmation-modal" class="modal hide" tabindex="-1" role="dialog">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" ng-click="cancelDischarge()">×</button>
		<h3>Discharge</h3>
	</div>
	<div class="modal-body">
		<form>
			<div>
				<label class="radio">
					<input type="radio" ng-model="discharge.category" value="Discharged">
					Discharge
				</label>
				<label class="radio">
					<input type="radio" ng-model="discharge.category" value="Followup">
					Discharge with follow-up
				</label>
				<label class="radio">
					<input type="radio" ng-model="discharge.category" value="Deceased">
					Deceased
				</label>
				<label class="radio">
					<input type="radio" ng-model="discharge.category" value="Transferred">
					Transferred
				</label>
				<label class="radio">
					<input type="radio" ng-model="discharge.category" value="Unfollow">
					No longer under active review
				</label>
			</div>
			<div ng-hide="discharge.category=='Unfollow'" class="control-group">
				<label class="control-label">Date of discharge</label>
				<div class="controls">
					<input type="text" ng-model="discharge.date" bs-datepicker>
				</div>
			</div>
		</form>
	</div>
	<div class="modal-footer">
		<button class="btn btn-primary" ng-click="doDischarge()">Discharge</button>
		<button class="btn" ng-click="cancelDischarge()">Cancel</button>
	</div>
</div>
